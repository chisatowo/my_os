# 操作系统真相还原第14章：文件系统
## 实验小节h:
实现文件删除功能:
1. 增添inode_delete函数,将文件从磁盘上移除,传入要删除的inode在inode数组中的索引，然后删除磁盘中的这个inode。这个函数可有可无，因为inode分配是依靠inode位图来完成的，我们回收一个inode，只需要回收一个inode位图中的位即可。因为下次分配这个inode位之后，新的inode数据会覆盖旧有inode数据，这样还能避免不必要的磁盘读写。函数原理：调用inode_locate可以将inode数组索引转换为这个inode在磁盘中的起始扇区和字节偏移。我们将这个inode所在整体扇区读出内存缓冲区中，然后将这个内存缓冲区中的inode清除，再将内存缓冲区中的数据写回磁盘中即可。
2. 增添inode_release函数,删除磁盘上的inode文件并回收所占用的块,通过调用inode_delete函数实现.
3. 增添delete_dir_entry函数,删除指定文件在对应磁盘中的目录项.核心原理：传入的要删除文件的父目录结构体struct dir指针内有inode成员，这个inode内有i_sectors[ ]记录着这个目录文件的存储位置，我们自然可以以块为单位从磁盘中把父目录文件读取到缓冲区中，然后遍历找到要删除的目录项，删除缓冲区内对应的目录项，然后写回缓冲区数据。
4. 增添函数sys_unlink,用于根据传入路径，删除非目录文件。原理：首先调用 search_file搜索路径以返回文件的inode，判断该inode是否对应某个打开全局文件结构，如果是，则说明此文件正在被使用，那么就不应该被删除。如果不是，调用 delete_dir_entry删除这个文件在磁盘中的目录项，调用inode_release删除inode对应的文件，这就完成了删除。
